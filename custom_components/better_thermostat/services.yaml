save_current_target_temperature:
  name: Save target temperature
  description: Save the current target temperature for later use.
  target:
    entity:
      domain: climate
      integration: better_thermostat

restore_saved_target_temperature:
  name: Restore target temperature
  description: Restore the previously saved target temperature.
  target:
    entity:
      domain: climate
      integration: better_thermostat

reset_heating_power:
  name: Reset heating power
  description: Reset the heating power to its default value.
  target:
    entity:
      domain: climate
      integration: better_thermostat

set_temp_target_temperature:
  name: Set temporary (ECO) target temperature
  description: Set a temporary target temperature and save the current temperature.
  fields:
    temperature:
      name: Temperature
      description: New target temperature to set
      required: true
      selector:
        number:
          min: 0
          max: 35
          step: 0.5
          mode: box
          unit_of_measurement: °C
  target:
    entity:
      domain: climate
      integration: better_thermostat

set_eco_mode:
  name: Set ECO mode
  description: Enable or disable ECO mode.
  fields:
    enable:
      name: Enable
      description: Enable or disable ECO mode.
      required: true
      selector:
        boolean: {}
  target:
    entity:
      domain: climate
      integration: better_thermostat

run_valve_maintenance:
  name: Run valve maintenance now
  description: Run the valve maintenance cycle immediately for this Better Thermostat entity.
  target:
    entity:
      domain: climate
      integration: better_thermostat

reset_pid_learnings:
  name: Reset PID learnings
  description: Clear all learned PID state (and optionally learned open caps) for this entity.
  fields:
    include_open_caps:
      name: Also clear learned open caps
      description: If enabled, also clears learned min/max open percentages per TRV/target bucket.
      required: false
      default: false
      selector:
        boolean: {}
    apply_pid_defaults:
      name: Apply PID defaults after reset
      description: If enabled, seeds the current target bucket(s) with PID default gains (kp/ki/kd). You can override defaults below.
      required: false
      default: false
      selector:
        boolean: {}
    defaults_kp:
      name: Default kp
      description: Proportional gain to seed after reset (falls back to BalanceParams.kp if not provided).
      required: false
      selector:
        number:
          min: 0
          max: 1000
          step: 0.1
    defaults_ki:
      name: Default ki
      description: Integral gain to seed after reset (falls back to BalanceParams.ki if not provided).
      required: false
      selector:
        number:
          min: 0
          max: 1
          step: 0.001
    defaults_kd:
      name: Default kd
      description: Derivative gain to seed after reset (falls back to BalanceParams.kd if not provided).
      required: false
      selector:
        number:
          min: 0
          max: 10000
          step: 10
  target:
    entity:
      domain: climate
      integration: better_thermostat

reset_mpc_state:
  name: Reset MPC state
  description: Clear or override MPC adaptive learnings for this Better Thermostat entity.
  fields:
    trv_entity_id:
      name: TRV entity id
      description: Limit the reset to a specific TRV entity id (as defined in the heater list).
      example: climate.living_room_valve
      required: false
    target_bucket:
      name: Target bucket
      description: Optional bucket filter (e.g. t21.0). Leave empty to touch all buckets for the TRV/entity.
      required: false
    reset_all:
      name: Remove stored state
      description: Delete matching MPC state entries instead of only overriding values. If no other option is provided, the service defaults to a full reset.
      required: false
      selector:
        boolean: {}
    clear_dead_zone:
      name: Clear dead-zone tracking
      description: Reset dead-zone hits/score and drop any learned min_effective_percent clamp without deleting other MPC data.
      required: false
      selector:
        boolean: {}
    gain_est:
      name: Override gain estimate
      description: Set a fixed thermal gain estimate (K/min at 100 % valve).
      required: false
      selector:
        number:
          min: 0
          max: 1
          step: 0.001
    loss_est:
      name: Override loss estimate
      description: Set a fixed thermal loss coefficient (relative °C/min).
      required: false
      selector:
        number:
          min: 0
          max: 0.2
          step: 0.0001
    min_effective_percent:
      name: Override minimum effective percent
      description: Force a minimum valve percentage that bypasses dead-zone detection (0-100%).
      required: false
      selector:
        number:
          min: 0
          max: 100
          step: 0.5
  target:
    entity:
      domain: climate
      integration: better_thermostat
